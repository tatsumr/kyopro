# Rolling Hash

## Rolling Hash の雑な説明

文字列をハッシュ化する. 具体的には, 長さ $n$ の文字列 $s_0s_1...s_{n-1}$ のハッシュは基数 $b$ を用いて

$\sum_{i=0}^{n-1}b^{n-i-1}s_i$

と表す. 

例えば $s="abc", b=10, "a"=1, "b"=2, "c"=3$ とするとハッシュ値は

$10^2\cdot1+10^1\cdot2+10^0\cdot3=123$

となる.

また, ハッシュ値は非常に大きくなる可能性があるので何かしらの数で割った余りをとる.

## 実装メモなど

### hash 配列
$hash[i]:=s[0,i)のハッシュ値$ とする $(hash[0]=0)$.

このとき $\textcolor{red}{hash[i]=hash[i-1]\cdot b+s_{i-1} (1 \leq i \leq n)}$

上の $s="abc"$ の例だと $hash = \lbrace 0, 1, 12, 123 \rbrace$ となる.

### 部分文字列のハッシュ
hash 配列を利用して, $s[l, r)$ のハッシュ値を求めたい.

$hash[l]=b^{l-1}s_0+b^{l-2}s_1+...+b^1s_{l-2}+b^0s_{l-1},$

$hash[r]=(b^{r-1}s_0+b^{r-2}s_1+...+b^{r-l+1}s_{l-2}+b^{r-l}s_{l-1})+(b^{r-l-1}s_l+b^{r-l-2}s_{l+1}+...+b^1s_{r-2}+b^0s_{r-1})$

より

$(s[l, r) のハッシュ値)$

$=b^{r-l-1}s_l+b^{r-l-2}s_{l+1}+...+b^1s_{r-2}+b^0s_{r-1}$

$=\textcolor{red}{hash[r]-hash[l]\cdot b^{r-l}}$

上の $s="abc"$ の例だと $s[1, 3)$ (="bc") のハッシュ値は 

$hash[3] - hash[1] \cdot 10^{3-1} = 123 - 100 = 23.$

### ハッシュの連結
ハッシュ値 $h1$ の文字列 $s1$ と長さ $x$, ハッシュ値 $h2$ の文字列 $s2$ を連結させた文字列 $s1+s2$ のハッシュ値は

$\textcolor{red}{h1\cdot b^x+h2}.$

例えば, 上の $s="abc"(ハッシュ値 123)にt="ba"(長さ2, ハッシュ値 21)を連結させた文字列 "abcba"$ のハッシュ値は

$123\cdot100^2+21=12321$
